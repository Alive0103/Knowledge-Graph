# 知识图谱项目说明文档

## 目录结构分析

```
kgcode/
├── converted-coreference-linked-with-wiki/      # 已转换的核心指代消解与维基链接数据
│   ├── labels.json                             # 标签数据
│   ├── ner/                                    # 命名实体识别相关数据
│   ├── re/                                     # 关系抽取相关数据
│   └── wiki/                                   # 维基百科相关数据
├── 实体链接/                                    # 实体链接模块
│   ├── createES.py                             # 创建Elasticsearch索引
│   ├── add_zhaliases.py                        # 添加中文别名
│   ├── toesdata.py                             # 导入数据到Elasticsearch
│   ├── search_label_aliases.py                 # 基于标签和别名的搜索
│   ├── search_withllm.py                       # 结合大语言模型的搜索
│   ├── get_image_content.py                    # 获取图像内容
│   ├── get_image_link.py                       # 获取图像链接
│   ├── get_relink_content.py                   # 获取重链接内容
│   ├── show.py                                 # 展示结果
│   └── 其他脚本文件...
├── 跨语言实体对齐/                              # 跨语言实体对齐模块
│   ├── run.py                                  # 主运行文件
│   ├── settings.py                             # 配置设置
│   ├── test.py                                 # 测试接口
│   └── 其他文件...
├── 中英文维基-部分/                             # 中英文维基百科数据
└── readme.md                                   # 项目说明文件
```

## 项目主要任务流程

### 1. 数据准备阶段
- 收集维基百科数据（中文和英文）
- 处理数据，包括实体识别、链接等预处理步骤

### 2. 实体链接模块
此模块负责将文本中的提及(Mention)链接到知识库中的实体(Entity)：

#### 主要组件：
- **createES.py**: 创建和配置Elasticsearch索引，支持拼音、IK分词器等多种分析器
- **add_zhaliases.py**: 利用机器翻译模型为实体添加中文别名
- **toesdata.py**: 将处理好的数据导入Elasticsearch数据库
- **search_label_aliases.py**: 基于标签和别名的传统搜索方法
- **search_withllm.py**: 结合大语言模型(GLM-4)的高级搜索方法

#### 工作流程：
1. 使用[createES.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/createES.py)创建Elasticsearch索引
2. 使用[add_zhaliases.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/add_zhaliases.py)为实体添加中文别名
3. 使用[toesdata.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/toesdata.py)将数据导入Elasticsearch
4. 使用[search_label_aliases.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/search_label_aliases.py)或[search_withllm.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/search_withllm.py)执行实体链接搜索

### 3. 跨语言实体对齐模块
此模块负责对齐不同语言间的相同实体：

#### 主要组件：
- **run.py**: 主要的训练和推理代码
- **settings.py**: 项目配置参数
- **test.py**: 提供Web API接口用于测试

#### 工作流程：
1. 使用LaBSE等多语言嵌入模型获取实体表示
2. 利用图注意力网络(GAT)处理邻域信息
3. 训练模型以对齐不同语言的相同实体
4. 通过[test.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E8%B7%A8%E8%AF%AD%E8%A8%80%E5%AE%9E%E4%BD%93%E5%AF%B9%E9%BD%90/test.py)提供API接口获取评估结果(Hit@1, Hit@10, MRR)

## 项目启动方法

### 启动前准备
1. 安装必要的依赖包
2. 启动Elasticsearch服务
3. 准备好维基百科数据集
4. 下载必要的模型文件(如BERT、LaBSE等)

### 实体链接模块启动步骤
1. 运行[createES.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/createES.py)创建Elasticsearch索引
2. 运行[add_zhaliases.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/add_zhaliases.py)处理数据并添加中文别名
3. 运行[toesdata.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/toesdata.py)导入数据到Elasticsearch
4. 运行[search_label_aliases.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/search_label_aliases.py)或[search_withllm.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E5%AE%9E%E4%BD%93%E9%93%BE%E6%8E%A5/search_withllm.py)进行实体链接搜索测试

### 跨语言实体对齐模块启动步骤
1. 确保已准备好训练数据和配置
2. 运行[run.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E8%B7%A8%E8%AF%AD%E8%A8%80%E5%AE%9E%E4%BD%93%E5%AF%B9%E9%BD%90/run.py)开始训练或推理过程
3. 运行[test.py](file:///D:/work/%E6%AF%95%E8%AE%BE/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/%E4%BB%A3%E7%A0%81/kgcode/%E8%B7%A8%E8%AF%AD%E8%A8%80%E5%AE%9E%E4%BD%93%E5%AF%B9%E9%BD%90/test.py)启动Web服务，可通过API获取测试结果

## 当前项目问题与改进方向

根据readme.md描述，当前项目存在以下问题需要改进：

1. 实体链接主要依赖Elasticsearch提供的关键词相似度查询，较少使用向量查询，未充分利用wiki页面内容
2. 在线wiki入库时，没有实现将图像资源保存在本地，并从本地加载资源的业务逻辑
3. 使用的维基百科数据范围有限，建议使用wikidump获取更全面的数据

## 后续工作建议

1. 增强向量搜索能力，更好地利用wiki页面内容
2. 实现图像资源的本地化存储和加载机制
3. 扩展数据来源，使用wikidump获取完整的维基百科数据
4. 设计结合实体知识与文档检索的RAG框架，实现面向组织级知识的智能问答与生成