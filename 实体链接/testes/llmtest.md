D:\software\anaconda\envs\kgcode\python.exe D:\work\毕设\知识图谱\Knowledge-Graph\实体链接\diagnose_entity_linking.py 
✓ Chinese-RoBERTa模型加载成功
================================================================================
实体链接诊断报告
================================================================================
总查询数: 444
诊断样本数: 20


================================================================================
查询 #1: 新一代“阿利·伯克”级驱逐舰
“阿利·伯克”Flight Ⅲ
正确答案: https://zh.wikipedia.org/wiki/%E9%98%BF%E5%88%A9%C2%B7%E4%BC%AF%E5%85%8B%E7%B4%9A%E9%A9%85%E9%80%90%E8%89%A6
================================================================================
诊断中:   0%|          | 0/20 [00:00<?, ?it/s]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/阿利·伯克級驅逐艦

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/阿利·伯克級驅逐艦

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #2: CG（X）
CG（X）巡洋舰
正确答案: https://zh.wikipedia.org/wiki/%E6%8F%90%E5%BA%B7%E5%BE%B7%E7%BD%97%E5%8A%A0%E7%BA%A7%E5%AF%BC%E5%BC%B9%E5%B7%A1%E6%B4%8B%E8%88%B0
================================================================================
诊断中:   5%|▌         | 1/20 [00:09<02:55,  9.25s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 10 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/提康德罗加级导弹巡洋舰

[步骤2] LLM重排序...
诊断中:  10%|█         | 2/20 [00:26<04:07, 13.73s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 2 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/提康德罗加级导弹巡洋舰

  📊 排名变化: 搜索第10位 -> 重排序第2位

================================================================================
查询 #3: 阿利·伯克级驱逐舰
正确答案: https://zh.wikipedia.org/wiki/%E9%98%BF%E5%88%A9%C2%B7%E4%BC%AF%E5%85%8B%E7%B4%9A%E9%A9%85%E9%80%90%E8%89%A6
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/阿利·伯克級驅逐艦

[步骤2] LLM重排序...
诊断中:  15%|█▌        | 3/20 [00:39<03:48, 13.43s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/阿利·伯克級驅逐艦

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #4: P226
P226手枪
瑞士西格绍尔公司P226
正确答案: https://zh.wikipedia.org/wiki/SIG_P226%E5%8D%8A%E8%87%AA%E5%8B%95%E6%89%8B%E6%A7%8D
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/SIG_P226半自動手槍

[步骤2] LLM重排序...
诊断中:  20%|██        | 4/20 [00:45<02:52, 10.79s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/SIG_P226半自動手槍

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #5: “奥奇瓦勇士”武装侦察直升机
OH-58D
正确答案: https://zh.wikipedia.org/wiki/OH-58%E5%A5%87%E5%A5%A7%E7%93%A6%E5%81%B5%E5%AF%9F%E7%9B%B4%E5%8D%87%E6%A9%9F
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/OH-58奇奧瓦偵察直升機

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/OH-58奇奧瓦偵察直升機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #6: “阿帕奇”攻击直升机
AH-64
正确答案: https://zh.wikipedia.org/wiki/AH-64%E9%98%BF%E5%B8%95%E5%A5%91%E7%9B%B4%E5%8D%87%E6%A9%9F
================================================================================
诊断中:  25%|██▌       | 5/20 [00:52<02:18,  9.25s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/AH-64阿帕契直升機

[步骤2] LLM重排序...
诊断中:  30%|███       | 6/20 [01:02<02:14,  9.62s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/AH-64阿帕契直升機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #7: 武装侦察直升机
ARH
正确答案: https://zh.wikipedia.org/wiki/ARH-70_%E9%98%BF%E6%8B%89%E5%B8%95%E9%9C%8D%E7%9B%B4%E5%8D%87%E6%A9%9F
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/ARH-70_阿拉帕霍直升機

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/ARH-70_阿拉帕霍直升機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #8: ARH-70
“阿拉帕霍”武装侦察直升机
阿拉帕霍
正确答案: https://zh.wikipedia.org/wiki/ARH-70_%E9%98%BF%E6%8B%89%E5%B8%95%E9%9C%8D%E7%9B%B4%E5%8D%87%E6%A9%9F
================================================================================
诊断中:  35%|███▌      | 7/20 [01:10<01:59,  9.16s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/ARH-70_阿拉帕霍直升機

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/ARH-70_阿拉帕霍直升機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #9: 科曼奇
RAH-66
正确答案: https://zh.wikipedia.org/wiki/RAH-66%E5%8D%A1%E6%9B%BC%E5%A5%91%E7%9B%B4%E5%8D%87%E6%A9%9F
================================================================================
诊断中:  40%|████      | 8/20 [01:19<01:46,  8.85s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/RAH-66卡曼契直升機

[步骤2] LLM重排序...
诊断中:  45%|████▌     | 9/20 [02:25<04:56, 26.93s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/RAH-66卡曼契直升機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #10: 奥奇瓦勇士
OH-58D
正确答案: https://zh.wikipedia.org/wiki/OH-58%E5%A5%87%E5%A5%A7%E7%93%A6%E5%81%B5%E5%AF%9F%E7%9B%B4%E5%8D%87%E6%A9%9F
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/OH-58奇奧瓦偵察直升機

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/OH-58奇奧瓦偵察直升機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #11: RAH-66
“科曼奇”隐身直升机
正确答案: https://zh.wikipedia.org/wiki/RAH-66%E5%8D%A1%E6%9B%BC%E5%A5%91%E7%9B%B4%E5%8D%87%E6%A9%9F
================================================================================
诊断中:  50%|█████     | 10/20 [02:43<04:01, 24.15s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/RAH-66卡曼契直升機

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/RAH-66卡曼契直升機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #12: 毒刺
复仇者
正确答案: https://zh.wikipedia.org/wiki/%E5%BE%A9%E4%BB%87%E8%80%85
================================================================================
诊断中:  55%|█████▌    | 11/20 [02:59<03:14, 21.60s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 2 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/復仇者防空飛彈系統

[步骤2] LLM重排序...
诊断中:  60%|██████    | 12/20 [03:16<02:41, 20.13s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 3 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/復仇者防空飛彈系統

  📊 排名变化: 搜索第2位 -> 重排序第3位
     ⚠ LLM重排序把正确答案排到了更后面!

================================================================================
查询 #13: 美国陆军
美军
正确答案: https://zh.wikipedia.org/wiki/%E7%BE%8E%E5%9B%BD%E9%99%86%E5%86%9B
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/美国陆军

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/美国陆军

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #14: F-35
“闪电”Ⅱ隐身战机
正确答案: https://zh.wikipedia.org/wiki/F-35%E9%96%83%E9%9B%BBII%E6%88%B0%E9%AC%A5%E6%A9%9F
================================================================================
诊断中:  65%|██████▌   | 13/20 [03:26<01:59, 17.07s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/F-35閃電II戰鬥機

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/F-35閃電II戰鬥機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #15: F-35
“闪电”Ⅱ
正确答案: https://zh.wikipedia.org/wiki/F-35%E9%96%83%E9%9B%BBII%E6%88%B0%E9%AC%A5%E6%A9%9F
================================================================================
诊断中:  70%|███████   | 14/20 [04:30<03:07, 31.17s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/F-35閃電II戰鬥機

[步骤2] LLM重排序...
诊断中:  75%|███████▌  | 15/20 [05:29<03:17, 39.59s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/F-35閃電II戰鬥機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #16: 斩首者
F-22
定位者
正确答案: https://zh.wikipedia.org/wiki/F-22%E7%8C%9B%E7%A6%BD%E6%88%B0%E9%AC%A5%E6%A9%9F
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 2 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/F-22猛禽戰鬥機

[步骤2] LLM重排序...
诊断中:  80%|████████  | 16/20 [07:08<03:50, 57.66s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/F-22猛禽戰鬥機

  📊 排名变化: 搜索第2位 -> 重排序第1位

================================================================================
查询 #17: 踢门者
F-22
正确答案: https://zh.wikipedia.org/wiki/F-22%E7%8C%9B%E7%A6%BD%E6%88%B0%E9%AC%A5%E6%A9%9F
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/F-22猛禽戰鬥機

[步骤2] LLM重排序...
诊断中:  85%|████████▌ | 17/20 [07:17<02:08, 42.88s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/F-22猛禽戰鬥機

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #18: SS-N-1“扫帚”
P-1
正确答案: https://zh.wikipedia.org/wiki/P-1%E6%B5%B7%E4%B8%8A%E5%B7%A1%E9%82%8F%E6%A9%9F
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/P-1海上巡邏機

[步骤2] LLM重排序...
诊断中:  90%|█████████ | 18/20 [07:32<01:09, 34.63s/it]  重排序后得到 20 个链接
  ✓ 重排序后第 19 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/P-1海上巡邏機

  📊 排名变化: 搜索第1位 -> 重排序第19位
     ⚠ LLM重排序把正确答案排到了更后面!

================================================================================
查询 #19: “山鹰”高级教练机
FTC-2000
正确答案: https://zh.wikipedia.org/wiki/%E6%95%99%E7%BB%83-9
================================================================================

[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/教练-9

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 1 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/教练-9

  ✓ 排名未变化: 都是第1位

================================================================================
查询 #20: “猎鹰”高级教练机
L15
猎鹰
正确答案: https://zh.wikipedia.org/wiki/%E6%95%99%E7%BB%83-10
================================================================================
诊断中:  95%|█████████▌| 19/20 [07:43<00:27, 27.43s/it]
[步骤1] 搜索结果: 找到 20 个候选实体
  ✓ 在搜索结果第 3 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/教练-10

[步骤2] LLM重排序...
  重排序后得到 20 个链接
  ✓ 重排序后第 2 位找到正确答案
    匹配的链接: https://zh.wikipedia.org/wiki/教练-10

  📊 排名变化: 搜索第3位 -> 重排序第2位


================================================================================
诊断统计报告
================================================================================
总查询数: 20
在搜索结果中找到: 20 (100.0%)
重排序后找到: 20 (100.0%)
搜索结果中未找到: 0 (0.0%)
重排序后未找到: 0 (0.0%)
LLM解析错误: 0 (0.0%)

================================================================================
问题分析
================================================================================

================================================================================
诊断中: 100%|██████████| 20/20 [07:49<00:00, 23.48s/it]

进程已结束，退出代码为 0


==================================================
评测结果:
==================================================
MRR: 0.7701
Hit@1: 0.7342
Hit@5: 0.8153
Hit@10: 0.8176

==================================================
评测结果:
==================================================
768 chinese-roberta-wwm-ext
MRR: 0.7735
Hit@1: 0.7387
Hit@5: 0.8198
Hit@10: 0.8311

进程已结束，退出代码为 0
1024 chinese-roberta-wwm-ext-large
==================================================
评测结果:
==================================================
MRR: 0.7749
Hit@1: 0.7410
Hit@5: 0.8198
Hit@10: 0.8311

---

日志文件: evaluation_log_20251127_135720.jsonl
摘要文件: evaluation_summary_20251127_135720.json

开始详细评测...
详细评测中: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 444/444 [24:43<00:00,  3.34s/it]

================================================================================
评测结果
================================================================================
MRR: 0.7793
Hit@1: 0.7500
Hit@5: 0.8131
Hit@10: 0.8198

================================================================================
评测统计摘要
================================================================================
总查询数: 444
成功: 444 (100.00%)
失败: 0 (0.00%)

错误统计:
  search_empty: 9

总耗时: 1483.34秒
平均每个查询: 3.34秒
================================================================================

================================================================================
详细错误报告
================================================================================

【搜索错误】共 9 个:
  1. 查询: 'FARA'
     错误: 搜索结果为空
  2. 查询: 'AAV7A1'
     错误: 搜索结果为空
  3. 查询: 'LRASM'
     错误: 搜索结果为空
  4. 查询: 'Mk41'
     错误: 搜索结果为空
  5. 查询: 'Mk14'
     错误: 搜索结果为空
  6. 查询: 'Block1B'
     错误: 搜索结果为空
  7. 查询: 'Block2'
     错误: 搜索结果为空
  8. 查询: 'Block3'
     错误: 搜索结果为空
  9. 查询: 'PKS'
     错误: 搜索结果为空
================================================================================

================================================================================
警告统计
================================================================================
  未找到正确答案: 69 次
  正确答案不在搜索结果中: 69 次
  搜索结果为空: 9 次
  重排序结果为空，使用原始结果: 9 次
================================================================================

================================================================================
失败查询分析（共 69 个）
================================================================================

未找到正确答案; 正确答案不在搜索结果中: 60 个查询
  示例: 广域海上监视
BAMS, 改进型
Block I, 改进型Block II, 澳大利亚海军“印度太平洋努力2021特遣部队”
“堪培拉”号两栖编, “孔茨”级
  ... 还有 55 个

搜索结果为空; 重排序结果为空，使用原始结果; 未找到正确答案; 正确答案不在搜索结果中: 9 个查询
  示例: FARA, AAV7A1, LRASM, Mk41, Mk14
  ... 还有 4 个
================================================================================

详细日志已保存到: evaluation_log_20251127_135720.jsonl
统计摘要已保存到: evaluation_summary_20251127_135720.json